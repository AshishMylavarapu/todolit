<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <script
      src="https://unpkg.com/react@16/umd/react.development.js"
      crossorigin
    ></script>
    <script
      src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"
      crossorigin
    ></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6"
      crossorigin="anonymous"
    />
    <title>todo</title>
  </head>
  <style>
    body{
      background-image: url(bg2.jpg);
      background-size: cover;
    }
  </style>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-xs-4"></div>
        <div class="col-xs-4">
          <br /><br /><br />
          <div id="#app" style="background-color: rgb(233, 226, 128)"></div>
        </div>
        <div class="col-xs-4"></div>
      </div>
    </div>
    <script type="text/babel">
      class Signin extends React.Component {
        constructor(props) {
          super(props);
          this.state = { input: "",time:"", list1: [], count: 0, deadline:"" };
        }
        componentDidMount() {
          var c = localStorage.getItem("count");
          const li = localStorage.getItem("list");
          if(li!=null){            
            const list=JSON.parse(li);
            list.map((ele,index)=>{
              var currentday = new Date();
              var month=currentday.getMonth()+1;
              if(month<10){
                month="0"+month;
              }
              var D=currentday.getDate();
              if(D<10){
                D="0"+D;
              }
              var date = currentday.getFullYear() + '-' + month + '-' + D;
              if(date>=ele.date){
                if(date>ele.date){
                  alert("time finished "+ ele.task+" is being delted");
                  list.splice(index,1);
                    c-=1;
                }
                else if(date==ele.date){
                  if(currentday.getHours()+":"+currentday.getMinutes()>=ele.time){
                    alert("time finished "+ ele.task+" is being delted");
                    list.splice(index,1);
                    c-=1;
                  }
                }
              }
            });            
              this.setState({ count: parseInt(c), list1: [...list] });
          }
          window.addEventListener("beforeunload", () => {
            localStorage.setItem("count", this.state.count);
            localStorage.setItem("list", JSON.stringify(this.state.list1));
          });
        }

        render() {
          return (
            <center>
              
                    <div>
                      <center>
                        <h2>
                          <label for="input" class="form-label">
                            To-do-List
                          </label>
                        </h2>
                        <br />
                        &ensp;
                        <label>
                           <h4> Name of the Task </h4>
                          </label>
                          &emsp;
                          &emsp;
                          &emsp;
                          &emsp;

                        <input
                          onChange={this.readName}
                          name="input"
                          type="text"
                          value={this.state.input}
                        />
                        <br />
                        <label>
                           <h4> Last date for Deadline </h4>
                          </label>
                          &emsp;
                        <input
                          onChange={this.readfate}
                          name="input"
                          type="date"
                          value={this.state.deadline}
                        />
                        <br />
                        <label>
                           <h4> Deadline time  </h4>
                          </label>
                        &emsp;
                        &emsp;
                        
                        <input
                          onChange={this.readtime}
                          name="input"
                          type="time"
                          value={this.state.time}
                        />
                        <br />
                        <br />                      
                        &emsp;<button onClick={this.handleClick} class ="btn btn-info" >Add Task</button>
                        <h4>Total tasks:{this.state.count}</h4>
                        <table class="table table-bordered border border-dark border-4">
                          <thead>
                            <tr>
                              <th colspan="1">S no.</th>
                              <th colspan="5"><center>Tasks</center></th>
                            </tr>
                          </thead>

                          <tbody>
                            {this.state.list1.map((ele, index) => (
                              <tr key={index}>
                                <td>{index + 1}</td>
                                <td scope="row">{ele.task}</td>
                                <td scope="row">{ele.date}</td>
                                <td scope="row">{ele.time}</td>

                                <td>
                                  <button
                                    onClick={this.handledelete}
                                    class ="btn btn-danger"
                                    value={index}
                                  >
                                    Delete
                                  </button>
                                </td>
                                <td>
                                  <button
                                    onClick={this.Modify}
                                    class ="btn btn-info"
                                    value={index}
                                  >
                                    Modify
                                  </button>
                                </td>
                              </tr>
                            ))}
                          </tbody>
                        </table>
                      </center>
                  
              </div>
            </center>
          );
        }

        Modify = (event) =>{
          localStorage.setItem("list", JSON.stringify(this.state.list1));
          ReactDOM.render(<Update numb={event.target.value}/>, document.getElementById("#app"));
        }

        readName = (event) => {
          this.setState({ input: event.target.value });
        };

        readtime = (event) => {
          this.setState({ time: event.target.value });
        };

        readfate = (event) => {
          this.setState({deadline:event.target.value});
        };

        handleClick = () => {
          this.setState({
            list1: [...this.state.list1, {task:this.state.input,date:this.state.deadline,time:this.state.time}],

            input: "",
            time:"",
            deadline:"",
            count: this.state.count + 1,
          });
        };

        handledelete = (event) => {
          const list = [...this.state.list1];

          list.splice(Number(event.target.value), 1);
          console.log(list);
          this.setState({ list1: [...list], count: this.state.count - 1 });
          console.log(event.target.value);
        };
      }

      ReactDOM.render(<Signin />, document.getElementById("#app"));
      class Update extends React.Component{

        constructor(){
          super();
          this.state={newtask:"",newdate:"",newtime:"",li:[]};
        }

        componentDidMount() {
            var c = localStorage.getItem("count");
          const li = localStorage.getItem("list");
            const list=JSON.parse(li);
            var name="";
            var t="";
            var d="";
            list.map((ele,index)=>{
              if(index==Number(this.props.numb)){
                name=ele.task;
                t=ele.time;
                d=ele.date;
              }
            });
            this.setState({li:[...list],newtask:name,newtime:t,newdate:d});
          window.addEventListener("beforeunload", () => {
            localStorage.setItem("list", JSON.stringify(this.state.li));
            ReactDOM.render(<Signin />, document.getElementById("#app"));
          });
        }

        render(){
          return(
            <div >

              <label>
                           <h4> TaskName  </h4>
                          </label>
                          <br />
                  <input
                          onChange={this.readName}
                          name="input"
                          type="text"
                          value={this.state.newtask}
                        />
                        <br />
                        <label>
                           <h4> Deadline Date  </h4>
                          </label>
                          <br />
                        <input
                          onChange={this.readfate}
                          name="input"
                          type="date"
                          value={this.state.newdate}
                        />
                        <br />
                        <label>
                           <h4> Deadline time  </h4>
                          </label>
                          
                        <br />
                        <input
                          onChange={this.readtime}
                          name="input"
                          type="time"
                          value={this.state.newtime}
                        />
                        <br />
                        <br />
                        <button
                          onClick={this.sub}
                          class ="btn-info"
                          >
                          Submit
                          </button>

                  </div>                 
          );
        }

        readName = (event) => {
          this.setState({ newtask: event.target.value });
        };

        readtime = (event) => {
          this.setState({ newtime: event.target.value });
        };

        readfate = (event) => {
          this.setState({newdate:event.target.value});
        };


        sub = () => {
          const old=[...this.state.li];
          old.map((ele,index)=>{
            if(index==Number(this.props.numb)){
              ele.task=this.state.newtask;
              ele.date=this.state.newdate;
              ele.time=this.state.newtime;
            }
          });
          this.setState({li:[...old]});
          

        };
      }
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
